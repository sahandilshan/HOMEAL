
<style>

    .btn-check-out {
        background-color: #EC7A23 !important;
        color: white !important;
        border-radius: 5px !important;
        margin: auto !important;
        width: 85% !important;
        text-shadow: none !important;
    }
    .btn-edit{
        background-color: #282F33 !important;
        margin-top: inherit;
        margin-bottom: inherit;
        background-image: url(../assets/icons/edit_icon.png);
        background-position: center;
        background-repeat: no-repeat;
        background-size: 28px 28px;
    }
    .btn-delete{
        border-bottom-right-radius: 11px;
        border-top-right-radius: 11px;
        margin-top: inherit;
        margin-bottom: inherit;
        background-image: url(../assets/icons/delete_icon.png);
        background-position: center;
        background-repeat: no-repeat;
        background-size: 28px 28px;
    }
    .label-price{
        margin-top: -3% !important;
        padding-bottom: 5px !important;
        padding-left:15px !important;
        font-size: 1rem !important;
    }

    .mt-3, .my-3 {
        margin-top: 0 !important;
    }
    .cart-md-font2 {
     font-size: 1rem !important;
    }
    .cart-md-font1 {
     font-size: 1.5rem !important;
    }

    .cart-card{
        width: 430px !important;
        padding-bottom: 20px !important;
    }

    .radio-item {
        position: relative;
        padding: 0 6px;
        margin: 10px 0 0;
    }

    .radio-item input[type='radio'] {
        display: none;
    }

    .radio-item label {
        color: #000000;
        font-weight: normal;
    }

    .radio-item label:before {
        content: " ";
        display: inline-block;
        position: relative;
        top: 5px;
        margin: 0 5px 0 0;
        width: 20px;
        height: 20px;
        border-radius: 11px;
        border: 2px solid #cacaca;
        background-color: transparent;
    }

    .radio-item input[type=radio]:checked + label:after {
        border-radius: 11px;
        width: 12px;
        height: 12px;
        position: absolute;
        top: 9px;
        left: 10px;
        content: " ";
        display: block;
        background: #EC7A23;
    }


    /***********************iphone potrait*************************/
    @media only screen and (max-width: 376px) {
        .cart-card{
            width: 340px !important;
            padding-bottom: 0px !important;
        }
        .cart-md-font2{
         font-size: 0.85rem !important;
        }
        .label-price{
            padding-top: 3px !important;
            font-size: 0.85rem !important;
        }
        .btn-check-out {
            background-color: #EC7A23 !important;
            color: white !important;
            border-radius: 5px !important;
            margin: auto !important;
            text-shadow: none !important;
            width: 90% !important;
            font-size: 0.85rem;
        }
        .btn-edit{
            background-size: 22px 22px;
        }
        .btn-delete{
            background-size: 22px 22px;
        }
        .cart-md-font1 {
            font-size: 1.1rem !important;
        }
    }

    /***********************iphone landscape*************************/
    @media only screen and (max-width: 667px) and (min-width: 376px) {

        .cart-card{
            width: 325px !important;
            padding-bottom: 0px !important;
        }
        .cart-md-font2 {
            font-size:0.8rem !important;
        }
        .label-price{
            font-size: 0.8rem !important;
            padding-top: 2px !important;
        }
        .btn-check-out {
            background-color: #EC7A23 !important;
            color: white !important;
            border-radius: 5px !important;
            margin: auto !important;
            width: 90% !important;
            text-shadow: none !important;
            font-size: 0.8rem;
        }
        .btn-edit{
            background-size: 22px 22px;
        }
        .btn-delete{
            background-size: 22px 22px;
        }
        .cart-md-font1 {
            font-size: 1.1rem !important;
        }
    }

</style>

<div data-role="popup" id="cart_popup"  class="cart-card" ata-position-to="window" data-overlay-theme="a"
     data-transition="pop" style="border-bottom-right-radius: 50px;padding:15px">
    <div class="row mb-2">
        <div class="col-9 text-center">
            <label style="position: relative;padding-left:70px;" ><strong class="cart-md-font1">Mini Cart</strong> </label>
        </div>
        <div class="col-3 custom-close-button">
            <a href="#" data-rel="back" data-role="button" data-transition="pop"
               class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all m-0">No text</a>
        </div>
    </div>

    <div class="row mt-n3">  <!--hr line-->
        <div class="col">
            <hr>
        </div>
    </div>

    <div class="row mb-2">
        <div class="col-sm-6 col-6">
            <label><strong class="cart-md-font2" style=" padding-left:15px !important;">Your Cart</strong> </label>
        </div>
        <div class="col-sm-6 col-6">
            <label class="cart-md-font2" style="float: right;
                          border: 1px solid red;
                          padding: 3px;
                          padding-left: 10px;
                          padding-right: inherit;
                          border-radius: 6px;
                          border-bottom-right-radius: 25px;">
                Delete all
            </label>
        </div>
    </div>


    <form>
        <div id="cartItems">
            <div class="row mb-3" style="margin-left: inherit;margin-right: inherit;">
                <div class="col-12">
                    <div class="row" style="box-shadow: 1px 7px 19px -9px #ec7a23;border-bottom-right-radius: 18px;">
                        <div class="col-8">
                            <label style="font-size: 1.2rem;"><b>Chicken Pizza (1)</b></label>
                            <label class="label-price">LKR 1050.00</label>
                        </div>
                        <div class="col-2 ui-btn ui-icon-cart ui-btn-icon-top"
                             style="margin-top: inherit;
                            margin-bottom: inherit;">
                        </div>

                        <div class="col-2 ui-btn ui-icon-cart ui-btn-icon-top"
                             style="margin-top: inherit;
                            margin-bottom: inherit;
                            border-bottom-right-radius: 11px;
                            border-top-right-radius: 11px;">
                        </div>
                    </div>
                </div>
            </div>

            <div class="row mb-3" style="margin-left: inherit;margin-right: inherit;">
                <div class="col-12">
                    <div class="row" style="box-shadow: 1px 7px 19px -9px #ec7a23;border-bottom-right-radius: 18px;">
                        <div class="col-8">
                            <label style="font-size: 1.2rem;"><b>Chicken Pizza (1)</b></label>
                            <label class="label-price">LKR 1050.00</label>
                        </div>
                        <div class="col-2 ui-btn ui-icon-cart ui-btn-icon-top"
                             style="margin-top: inherit;
                            margin-bottom: inherit;">
                        </div>

                        <div class="col-2 ui-btn ui-icon-cart ui-btn-icon-top"
                             style="margin-top: inherit;
                            margin-bottom: inherit;
                            border-bottom-right-radius: 11px;
                            border-top-right-radius: 11px;">
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </form>


    <div class="row mt-n3">  <!--hr line-->
        <div class="col">
            <hr style="margin-top: 15%">
        </div>
    </div>

    <div class="row mb-3 mt-3">
        <div class="col-12">
            <button id="toCheckout" class="ui-btn btn-check-out">
                Proceed to Checkout
            </button>
        </div>
    </div>
</div>

<!--Delivery Modal-->
<div data-role="popup"data-history="false" id="delivery_details" class="custom-filter-delivery" data-position-to="window"
     data-overlay-theme="a"
     data-transition="pop" style="border-radius: 10px;height: 100%;margin-top: -46%;">
    <div class="row mb-2">

        <div class="col-2">
            <button data-rel="back" class="ui-btn ui-btn-icon-left ui-icon-back-popup custom-back"></button>
        </div>


        <div class="col-10">
            <label style="position: relative;text-align: -webkit-center;margin-left: -16%;font-size: 1.2rem;">
                <strong>Delivery Details</strong>
            </label>
        </div>

    </div>


    <div class="row mb-2">
        <div class="col-6">
            <label style="text-align: -webkit-center;">Saved Address</label>
        </div>
        <div class="col-6">
            <label style="text-align: -webkit-center;">
                New Address
            </label>
        </div>
    </div>


    <div class="row mb-2">
        <div class=" radio-item" style="margin-left:20% !important;margin-top: -17px;">
            <input type='radio' data-role="none" id='radio_1' name='type' value='1' />
            <label for="radio_1"></label>
        </div>
        <div class=" radio-item" style="margin-left: 40%;margin-top: -17px;">
            <input type='radio' data-role="none" id='radio_2' name='type' value='1' />
            <label for="radio_2"></label>
        </div>
    </div>

    <div class="row mt-n3">  <!--hr line-->
        <div class="col" style="margin-top: 2%;">
            <hr>
        </div>
    </div>

    <!--Selecting current address form-->
    <form>
        <div class="row mb-3" style="margin-left: inherit;margin-right: inherit;">
            <div class="col-12">
                <div class="row" style="box-shadow: 1px 7px 19px -9px #282F33;border-radius: 5px;">
                    <div class="col-10">
                        <label style="font-size: 1.1rem;margin-top: 7px;"><b>Home</b></label>

                    </div>

                    <div class="col-2">
                        <a href="#" data-rel="back" data-role="button" data-transition="pop"
                           class="ui-btn ui-icon-check ui-btn-icon-notext ui-corner-all" style="background-color: #EC7A23">No text</a>
                    </div>
                    </div>
                </div>

            <div class="col-12" style="margin-top: 10px !important;">
                <div class="row" style="box-shadow: 1px 7px 19px -9px #282F33;border-radius: 5px;">
                    <div class="col-10">
                        <label style="font-size: 1.1rem;margin-top: 7px;font-weight: normal !important;"><b>Office</b></label>

                    </div>

                    <div class="col-2">
                        <!--<a href="#" data-rel="back" data-role="button" data-transition="pop"-->
                           <!--class="ui-btn ui-icon-check ui-btn-icon-notext ui-corner-all" style="background-color: #AAAAAA">No text</a>-->
                    </div>
                </div>
            </div>
            </div>
    </form>

    <!--New Address form-->
    <!--<form>-->
    <!--<div class="row mb-3" style="margin-left: inherit;margin-right: inherit;">-->
    <!--<div class="col-12">-->

    <!--<div class="row">-->
    <!--<div class="col-10">-->
    <!--<a href="#popupBasicLocation" data-rel="popup" data-transition="pop"-->
    <!--class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-location custom-search-bar">Colombo 10</a>-->
    <!--</div>-->
    <!--</div>-->


    <!--<div class="row" style="box-shadow: 1px 7px 19px -9px #afaead;border-radius: 7px;margin-top: 5px;">-->
    <!--<div class="col-10">-->
    <!--<label style=" font-size: 0.8rem;margin-top: 10px;margin-bottom: 10px;color: #ec7a23;">-->
    <!--House Number-->
    <!--</label>-->
    <!--</div>-->
    <!--</div>-->

    <!--<div class="row" style="box-shadow: 1px 7px 19px -9px #afaead;border-radius: 7px;margin-top: 5px;">-->
    <!--<div class="col-10">-->
    <!--<label style=" font-size: 0.8rem;margin-top: 10px;margin-bottom: 10px;color: #ec7a23;">-->
    <!--Street Name-->
    <!--</label>-->
    <!--</div>-->
    <!--</div>-->

    <!--<div class="row" style="box-shadow: 1px 7px 19px -9px #afaead;border-radius: 7px;margin-top: 5px;">-->
    <!--<div class="col-10">-->
    <!--<label style="font-size: 0.8rem;margin-top: 10px;margin-bottom: 10px;color: #ec7a23;">-->
    <!--City / Town-->
    <!--</label>-->
    <!--</div>-->
    <!--</div>-->


    <!--<div class="row" style="margin-top: 5px;">-->
    <!--<div class="col-8">-->
    <!--<label style="font-size: 0.8rem;margin-top: 10px;margin-bottom: 10px;color: #ec7a23;">-->
    <!--Save this address-->
    <!--</label>-->
    <!--</div>-->
    <!--<div class="col-2 custom-switch" style="margin-top: 5px;margin-left: 6px;">-->
    <!--<select name="flip-2" id="save" data-role="slider" style="width: 4.0em;">-->
    <!--<option value="off"></option>-->
    <!--<option value="on"></option>-->
    <!--</select>-->
    <!--</div>-->
    <!--</div>-->



    <!--<div class="row" style="box-shadow: 1px 7px 19px -9px #afaead;border-radius: 7px;margin-top: 5px;">-->
    <!--<div class="col-10">-->
    <!--<label style="font-size: 0.8rem;margin-top: 10px;margin-bottom: 10px;color: #ec7a23;">-->
    <!--Label Name-->
    <!--</label>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</div>-->
    <!--</form>-->


    <div class="row mt-n3">  <!--hr line-->
        <div class="col">
            <hr style="margin-top: 10%">
        </div>
    </div>

    <div class="row mb-2 mt-3">
        <div class="col-12">
            <button onclick='window.location.href="../home/Checkout.html"' class="ui-btn btn-check-out">
                Proceed to Checkout
            </button>
        </div>
    </div>
</div>

<script>
    $(document).ready(function () {
        let cartItemsArr = JSON.parse(sessionStorage.getItem('cartItems'));
        let nav_bar_cart = $( "#nav_bar_cart" );
        if (cartItemsArr) {
            nav_bar_cart.removeClass('ui-icon-cart');
            nav_bar_cart.addClass('ui-icon-cart-with-items');
        } else {
            nav_bar_cart.addClass('ui-icon-cart');
            nav_bar_cart.removeClass('ui-icon-cart-with-items');
        }
    });

    $("#cart_popup").enhanceWithin().popup({
        afterclose: function () {
            let cartItemsArr = JSON.parse(sessionStorage.getItem('cartItems'));
            let nav_bar_cart = $( "#nav_bar_cart" );
            if (cartItemsArr) {
                nav_bar_cart.removeClass('ui-icon-cart');
                nav_bar_cart.addClass('ui-icon-cart-with-items');
            } else {
                nav_bar_cart.addClass('ui-icon-cart');
                nav_bar_cart.removeClass('ui-icon-cart-with-items');
            }
            nav_bar_cart.removeClass("ui-btn-active");
        }
    }).popup("close");

    $("#delivery_details").enhanceWithin().popup({

    }).popup("close");

    $('#nav_bar_cart').click(function () {
        let user = JSON.parse(sessionStorage.getItem('user'));
        if(!!user) {
            let cartItemsArr = JSON.parse(sessionStorage.getItem('cartItems'));
            let cartItems = '';
            if (cartItemsArr) {
                $( "#nav_bar_cart" ).addClass('ui-icon-cart');
                $( "#nav_bar_cart" ).removeClass('ui-icon-cart-with-items');
                cartItemsArr = cartItemsArr['items'];
                $.each(cartItemsArr, function (i, item) {
                    let totalPrice = (item['price'] * item['qty']).toFixed(2);
                    let itemHtml = `
        <div class="row mb-3" id="${item['product_id']}"style="margin-left: inherit;margin-right: inherit;">
                <div class="col-lg-12 col-md-12 col-sm-12 col-12">
                    <div class="row" style="box-shadow: 1px 7px 19px -9px #ec7a23;border-bottom-right-radius: 18px;">
                        <div class="col-lg-8 col-md-8 col-sm-8 col-8">
                            <div class="row">
                            <label class="cart-md-font2 text-left" style=" padding-left:15px !important;"><b>${item['product_name']}</b> (${item['variant']} x ${item['qty']})</label>
                            </div><div class="row">
                            <label class="label-price ">LKR ${totalPrice}</label></div>
                        </div>
                        <div class="col-lg-2 col-md-2 col-sm-2 col-2 btn-edit ui-btn">
                        </div>

                        <div class="col-lg-2 col-md-2 col-sm-2 col-2 ui-btn btn-delete" onclick="cart_item_remove('${item['product_id']}')">
                        </div>
                    </div>
                </div>
            </div>
        `;
                    cartItems += itemHtml;
                });
            } else {
                cartItems = '<p class="text-center">No items available </p>';
            }
            $('#cartItems').html(cartItems);
            let cartButton = $('#toCheckout');
            let itemsArr = JSON.parse(sessionStorage.getItem('cartItems'));
            cartButton.prop('disabled', false);
            if (itemsArr) {
                if (itemsArr['items'] === 0) {
                    cartButton.prop('disabled', true);
                }
            } else {
                cartButton.prop('disabled', true);
            }
            $("#cart_popup").popup('open');
        } else {
            $('#signin-required-modal').popup('open');
        }
    });

    $('#toCheckout').click(function () {
        sessionStorage.setItem('isBuyNow', '0');
        openDelivery = true;
        popupDeliveryModal();
    });

    function popupDeliveryModal() {
        let cartModal = $("#cart_popup");
        cartModal.popup('close');
        cartModal.on("popupafterclose", function () {
            //any action you want like opening another popup
            if (openDelivery) {
                let productModel = $("#delivery_details");
                $("#radio_1").prop("checked", true);
                productModel.popup("open");
                openDelivery = false;
            }
        });
    }

    function cart_item_remove(id){
        let cartItemsArrMain = JSON.parse(sessionStorage.getItem('cartItems'));
        let cartItemsArr = cartItemsArrMain['items'];
        $.each(cartItemsArr, function (i, item) {
            if(item['product_id']===id){
             cartItemsArr = $.grep(cartItemsArr, function(found) {
                 return found != item;
             });
         }
        });
        cartItemsArrMain['items']=cartItemsArr;
        if(cartItemsArr.length===0){
            sessionStorage.removeItem('cartItems');
            $('#'+id).addClass('d-none');
            $('#cartItems').html('<p class="text-center">No items available </p>');
        }
        else{
        sessionStorage.setItem('cartItems', JSON.stringify(cartItemsArrMain));
        $('#'+id).addClass('d-none');
        }
        let cartButton = $('#toCheckout');
        let itemsArr = JSON.parse(sessionStorage.getItem('cartItems'));
        cartButton.prop('disabled', false);
        if (itemsArr) {
            if (itemsArr['items'] === 0) {
                cartButton.prop('disabled', true);
            }
        } else {
            cartButton.prop('disabled', true);
        }
    }

</script>
