<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <link rel="icon" href="../assets/logos/Title.png"
          type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"/>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">

    <link rel="stylesheet" href="../css/custom.css"/>
    <script src="https://checkout.stripe.com/checkout.js"></script>

    <style>

        .btn-promocode {
            border: 1px solid red;
            border-radius: 11px;
            border-bottom-right-radius: 45px;
            padding-right: 15px;
            padding-top: 5px;
            padding-bottom: 5px;
            padding-left: 15px;
            text-shadow: none !important;
            background-color: #f9f9f9;
            font-size: 12px;
        }

        .navigation {
            margin-top: 0% !important;
        }

        .promocode {
            border: 1px solid red;
            border-radius: 11px;
            border-bottom-right-radius: 45px;
            padding: 8px;
            padding-right: 20px;
            padding-left: 14px;
        }

        .half-hr {
            flex-basis: 0;
            -ms-flex-positive: 1;
            flex-grow: 1;
            max-width: 100%;
            padding: 0;
        }

        .price-list {
            text-align: -webkit-right;
            font-size: 0.8rem;
        }

        .add-more-items {
            border: 1px solid red;
            padding-right: 15px;
            padding-top: 5px;
            padding-bottom: 5px;
            padding-left: 15px;
            border-radius: 11px;
            border-bottom-right-radius: 45px;
            font-size: 0.8rem;
            font-size: 12px;
        }

        .ui-checkbox .ui-btn, .ui-radio .ui-btn {
            margin: 0 !important;
            text-align: left !important;
            white-space: normal !important;
            z-index: 0 !important;
        }

        .card {
            background: #FFF;
            border: 1px solid #AAA;
            box-shadow: 0 2px 3px 0 #AAA;
            padding: 0;
            /*margin-right: 7.5px;*/
            margin-bottom: 15px;
            /*margin-left: 7.5px;*/
            overflow: hidden;
            border-radius: 3px;
            height: 190px;
            width: 100%;
        }

        .card-image {
            width: 100%;
            height: 160px;
            padding: 0;
            margin: 0;
            background-position: center;
            background-repeat: no-repeat;
            position: relative;
            overflow: hidden;
        }

        .card-title {
            position: absolute;
            bottom: 0;
            color: black;
            margin: 0;
            padding: 5px;
            border: none;
            padding-left: 8px !important;
        }

        .card-rating {
            bottom: 0;
            color: black;
            margin: 0;
            padding: 5px;
            border: none;
            float: right !important;
            padding-right: 8px !important;
        }

        .custom-star {
            height: 23px;
            width: 23px;
        }
    </style>

</head>
<body>
<div data-role="page">
    <div class="top pl-3 pr-3 pb-2 fixed-top">
        <div data-role="header" class="mb-1 header">
            <button data-rel="back" class="ui-btn ui-btn-icon-left ui-icon-back custom-back" id="backBtn">Back</button>
            <h1>
                <img src="../assets/logos/MainLight.png" class="img-fluid" alt="Logo.png">
            </h1>
            <button class="ui-btn-right ui-btn ui-btn-icon-notext ui-icon-notification">Notification</button>
        </div>
        <div class="row justify-content-center">
            <div class="col-sm-10">
                <a href="#popupBasicLocation" data-rel="popup" data-transition="pop"
                   class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-location custom-search-bar">Colombo
                    10</a>
            </div>
        </div>
        <div class="row mt-n2"> <!--first hr line-->
            <div class="col">
                <hr>
            </div>
        </div>

        <div class="row mt-n3 navigation">
            <div class="col"><span id="search-nav-text">Search</span> / <span id="merchant-nav-text">Merchant</span>  / <span style="color: #F19B55; font-weight: bold">Checkout</span></div>
        </div>

    </div>

    <div class="main" style="margin-top:11rem !important;"> <!--content area starts from here-->
        <div class="mt-n4">
            <div class="container">
                <div class="row">

                    <div id="checkout-delivery-address" class="col-12 col-sm-6" style="width: 100%;margin-left: auto;margin-right: auto;display: block">

                        <div style="font-size: 18px">
                            <b>Delivery Address</b>
                        </div>

                        <div>
                            <div style="margin-top: 3%;margin-bottom: 5%">
                                <a href="#popupBasicLocation" data-rel="popup" data-transition="pop"
                                   class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-location custom-search-bar">Colombo
                                    10</a>
                            </div>
                        </div>

                        <div class="row mt-n2"> <!--first hr line-->
                            <div class="half-hr ml-3 mr-3">
                                <hr class="m-1">
                            </div>
                        </div>


                    </div>

                    <!--Cart Modal-->
                    <div id="cartModal"></div>


                    <div id="checkout-payment-method" class="col-12 col-sm-6" style="width: 100%;margin-left: auto;margin-right: auto;display: block">
                        <div style="font-size: 18px"><b>Payment Method</b></div>

                        <div>

                            <form>
                                <div class="row" style="margin-left: auto;margin-top: 3.8%;">
                                    <!--<div >-->
                                    <!--<label  class="ui-radio-btn" style="border: none;background-color: #f9f9f9">-->
                                    <!--Cash-->
                                    <!--</label>-->
                                    <!--<input type="radio" name="size" id="radio-small">-->
                                    <!--</div>-->

                                    <!--<div >-->
                                    <!--<label  class="ui-radio-btn" style="border: none;background-color: #f9f9f9">-->
                                    <!--Card-->
                                    <!--</label>-->
                                    <!--<input type="radio" name="size" id="radio-small">-->
                                    <!--</div>-->

                                    <label class="ui-radio-btn">Cash</label><input type="radio" name="size"
                                                                                   id="radio-cash">

                                    <label class="ui-radio-btn" style="margin-left: 20%">Card</label><input type="radio"
                                                                                                            name="size"
                                                                                                            id="radio-card">
                                </div>
                            </form>

                        </div>

                        <div class="row mt-n2"> <!--first hr line-->
                            <div class="half-hr ml-3 mr-3">
                                <hr style="margin-bottom: 7px !important;">
                            </div>
                        </div>

                    </div>
                </div>

                <!--<div class="row mt-n2"> &lt;!&ndash;first hr line&ndash;&gt;-->
                <!--<div class="col">-->
                <!--<hr>-->
                <!--</div>-->
                <!--</div>-->

                <div class="container">
                    <div class="row">

                        <div id="checkout-cart" class="col-12 col-sm-6" style="width: 100%;margin-left: auto;margin-right: auto;display: block">
                            <div class="row">
                                <div class="col-6" style="font-size: 18px;margin-left: inherit">
                                    <b>Your Order</b>
                                </div>
                                <div class="col-6 float-right p-0" style="">
                                    <div class="add-more-items">
                                        + Add More Items
                                    </div>
                                </div>
                            </div>

                            <!--<div class="row" style="margin-left: inherit">
                                <div style="width: 100%">
                                    <div class="row"
                                         style="margin-top: 20px; width: 100%;border: 0.5px solid #dddddd;border-radius: 6px;">

                                        <div class="col-8"
                                             style="background-color: white;width: 50%;padding: 10px;border-radius: 6px">
                                            <div style="font-size: 1rem"><b>Beef Pizza (1)</b></div>
                                            <div style="font-size: 0.8rem">LKR 1000.00</div>
                                        </div>
                                        <div class="col-2"
                                             style="background-color: black;padding: 10px; text-align-last: center;">
                                            <img src="../assets/icons/ordersIcon_orange.png"
                                                 alt="Logo.png"
                                                 style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                                        </div>
                                        <div class="col-2"
                                             style="background-color: #f6f6f6;padding: 10px;border-radius: 6px;  text-align-last: center; ">
                                            <img src="../assets/icons/ordersIcon_orange.png"
                                                 alt="Logo.png"
                                                 style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                                        </div>
                                    </div>
                                </div>
                            </div>-->
                            <!--<div class="row" style="margin-left: inherit">
                                <div style="width: 100%">
                                    <div class="row"
                                         style="margin-top: 20px; width: 100%;border: 0.5px solid #dddddd;border-radius: 6px;">

                                        <div class="col-8"
                                             style="background-color: white;width: 50%;padding: 10px;border-radius: 6px">
                                            <div style="font-size: 1rem"><b>Beef Pizza (1)</b></div>
                                            <div style="font-size: 0.8rem">LKR 1000.00</div>
                                        </div>
                                        <div class="col-2"
                                             style="background-color: black;padding: 10px; text-align-last: center;">
                                            <img src="../assets/icons/ordersIcon_orange.png"
                                                 alt="Logo.png"
                                                 style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                                        </div>
                                        <div class="col-2"
                                             style="background-color: #f6f6f6;padding: 10px;border-radius: 6px;  text-align-last: center; ">
                                            <img src="../assets/icons/ordersIcon_orange.png"
                                                 alt="Logo.png"
                                                 style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                                        </div>
                                    </div>
                                </div>
                            </div>-->

                        </div>

                        <div id="checkout-total" class="col-12 col-sm-6 mt-3 mb-3" style="width: 100%;margin-left: auto;margin-right: auto;display: block">

                            <div class="row mb-2 ">
                                <div  class="col-sm-12 col-md-6 "></div>
                                <div  class="col-sm-12 col-md-6 ">
                                    <fieldset class="ui-grid-b">
                                        <div class="">
                                            <input class="btn-promocode" placeholder="Enter Promo Code" style="border: 1px solid #ec7a23;

    padding-right: 0;
    text-align-last: center;"/>
                                        </div>
                                    </fieldset>
                                </div>
                            </div>

                            <div>
                                <div class="row-12 p-0">

                                    <div class="col-6 float-left p-0">
                                        <div style="font-size: 0.8rem">Subtotal</div>
                                        <div style="font-size: 0.8rem">Tax</div>
                                        <div style="font-size: 0.8rem">Delivery Fee</div>
                                        <div style="font-size: 1rem"><b>Total</b></div>
                                    </div>

                                    <div class="col-6 float-right p-0">
                                        <div id="subTotal" class="price-list">LKR 1020.00</div>
                                        <div id="tax" class="price-list">LKR 80.00</div>
                                        <div id="deliveryFee" class="price-list">LKR 100.00</div>
                                        <div id="total" class="price-list" style="font-size: 1rem;font-weight: bold"><b>LKR 1200.00</b></div>
                                    </div>

                                </div>
                            </div>
                        </div>


                    </div>
                </div>
                <div class="row mt-3" >
                    <div class="col-12" id="checkout-btn-div" style="width: 100%;margin-left: auto;margin-right: auto;display: block">
                        <button  id="checkoutButton" style="text-shadow: none !important;
            color: white !important;
            background: #ec7a23 !important;
            border-radius: 8px;
            font-size: 12px !important;
            line-height: 18px;
"><span>Checkout</span></button>
                    </div>
                </div>
            </div>
        </div>

    </div>

    <!--Footer-->
    <div class="footer">
        <div class="row justify-content-between">
            <div class="col d-flex justify-content-left ml-3 p-3">
                <img src="../assets/logos/AltDark.png" class="img-fluid" alt="logo">
            </div>
            <div class="col mr-3 p-3">
                <div class="row">
                    <div class="col font1">Privacy Policy Terms of Use</div>
                    <div class="w-100"></div>
                    <div class="col font2">© 2020 HOMEAL. All rights reserved</div>
                </div>
            </div>
        </div>
    </div>

    <div data-role="footer" class="fixed-bottom">
        <nav data-role="navbar">
            <ul>
                <li><a href="#" class="ui-btn ui-icon-home ui-btn-icon-top ui-btn-active ui-state-persist">Home</a></li>
                <li><a href="#" class="ui-btn ui-icon-orders ui-btn-icon-top">Orders</a></li>
                <li><a href="#" id="cartBtn" class="ui-btn ui-icon-cart ui-btn-icon-top">Cart</a></li>
                <li><a href="#" class="ui-btn ui-icon-profile ui-btn-icon-top">Profile</a></li>
            </ul>
        </nav>
    </div>
</div>
</body>

<script>
    let total = 0;
    $(document).ready(function () {
        $('.btn-promocode').removeClass('ui-btn');
        changeIpadScreen(); // if page is load with  the ipad screen.

        let isBuyNow = sessionStorage.getItem('isBuyNow');
        if (isBuyNow == 1) {
            console.log('BuyNow');
            buyNow();

        } else {
            console.log('here');
            cartItem();
        }
    });

    $(window).resize(function() {
        changeIpadScreen(); // if page is changed from a difference screen.
    });

    function changeIpadScreen() {
        let width = $(window).width();
        if (width===768){
            $("#checkout-delivery-address").addClass("col-md-10");
            $("#checkout-payment-method").addClass("col-md-10");
            $("#checkout-cart").addClass("col-md-10");
            $("#checkout-total").addClass("col-md-10");
            $("#checkout-btn-div").addClass("col-md-10");
        }
        else{
            $("#checkout-delivery-address").removeClass("col-md-10");
            $("#checkout-payment-method").removeClass("col-md-10");
            $("#checkout-cart").removeClass("col-md-10");
            $("#checkout-total").removeClass("col-md-10");
            $("#checkout-btn-div").removeClass("col-md-10");
        }
    }

    $( "#backBtn" ).click(function() {
        window.history.back();
    });

    function buyNow() {
        let item = sessionStorage.getItem('buyNowItem');
        item = JSON.parse(item);
        console.log(item);
        let itemName = item.product_name;
        let qty = item.qty;
        let price = item.price * qty;
        let priceWithCents = price.toFixed(2);

        let order = `
        <div class="row" style="margin-left: inherit">
            <div style="width: 100%">
                <div class="row"
                     style="margin-top: 20px; width: 100%;border: 0.5px solid #dddddd;border-radius: 6px;">

                    <div class="col-8"
                         style="background-color: white;width: 50%;padding: 10px;border-radius: 6px">
                        <div style="font-size: 1rem"><b>${itemName} (${qty})</b></div>
                        <div style="font-size: 0.8rem">LKR ${priceWithCents}</div>
                    </div>
                    <div class="col-2"
                         style="background-color: black;padding: 10px; text-align-last: center;">
                        <img src="../assets/icons/edit_icon.png"
                             alt="Logo.png"
                             style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                    </div>
                    <div class="col-2"
                         style="background-color: #f6f6f6;padding: 10px;border-radius: 6px;  text-align-last: center; ">
                        <img src="../assets/icons/delete_icon.png"
                             alt="Logo.png"
                             style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                    </div>
                </div>
            </div>
        </div>
        `;
        $("#checkout-cart").append(order);
        $('#subTotal').text('LKR ' + priceWithCents);
        $('#total').text('LKR ' + (price + 100 + 80).toFixed(2));
        total = price + 100 + 80;
    }

    function cartItem() {
        let itemsArr = sessionStorage.getItem('cartItems');
        itemsArr = JSON.parse(itemsArr);
        itemsArr = itemsArr['items'];
        console.log(itemsArr);
        let items = '';
        let subTotal = 0;
        $.each(itemsArr, function (i, item) {
            console.log(item);
            let itemName = item.product_name;
            let qty = item.qty;
            let price = item.price * qty;
            subTotal += price;
            let priceWithCents = price.toFixed(2);

            let order = `
                <div class="row" style="margin-left: inherit">
                    <div style="width: 100%">
                        <div class="row"
                             style="margin-top: 20px; width: 100%;border: 0.5px solid #dddddd;border-radius: 6px;">

                            <div class="col-8"
                                 style="background-color: white;width: 50%;padding: 10px;border-radius: 6px">
                                <div style="font-size: 1rem"><b>${itemName} (${qty})</b></div>
                                <div style="font-size: 0.8rem">LKR ${priceWithCents}</div>
                            </div>
                            <div class="col-2"
                                 style="background-color: black;padding: 10px; text-align-last: center;">
                                <img src="../assets/icons/edit_icon.png"
                                     alt="Logo.png"
                                     style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                            </div>
                            <div class="col-2"
                                 style="background-color: #f6f6f6;padding: 10px;border-radius: 6px;  text-align-last: center; ">
                                <img src="../assets/icons/delete_icon.png"
                                     alt="Logo.png"
                                     style="width:30px ; height: 25px; vertical-align: -webkit-baseline-middle;">
                            </div>
                        </div>
                    </div>
                </div>
        `;
            items += order;
        });

        $("#checkout-cart").append(items);
        $('#subTotal').text('LKR ' + subTotal.toFixed(2));
        $('#total').text('LKR ' + (subTotal + 100 + 80).toFixed(2));
        total = subTotal;
    }

    jQuery(function($) {
        var handler = StripeCheckout.configure({
            key: 'pk_test_cp21BcECf4kMMUbSlRlZlsMo',
            token: function(token) {
                // Use the token to create the charge with a server-side script.
                // You can access the token ID with `token.id`

                //This will be printed when the transaction is successful. To charge, server side scripting is required.
                if(token.id){
                    window.location.href="/HOMEAL/home/CheckoutStatusSuccess.html";
                } else{
                    window.location.href="/HOMEAL/home/CheckoutStatusError.html";
                }
            }
        });


        $('#checkoutButton').on('click', function(e) {
            // Code Section B  Open Checkout with further options
            handler.open({
                name: 'Football Example',//merchant name
                currency: 'gbp',
                description: "2 Items",//number of items
                amount: total * 100
            });
            e.preventDefault();
        });

        // Code Section C  Close Checkout on page navigation
        $(window).on('popstate', function() {
            handler.close();
        });
    });
    $( "#cartModal" ).load( "../common/Cart_N_Delivery_Modal.html" );

    $( "#search-nav-text" ).click(function() {
            window.location.href ='./Search.html'
    });
    $( "#merchant-nav-text" ).click(function() {
        window.history.back();
    });

</script>

</html>
