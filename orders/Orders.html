<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Orders</title>
    <link rel="icon" href="../assets/logos/Title.png"
          type="image/x-icon">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.css"/>
    <script src="http://code.jquery.com/jquery-1.11.1.min.js"></script>
    <script src="http://code.jquery.com/mobile/1.4.5/jquery.mobile-1.4.5.min.js"></script>

    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

    <link rel="stylesheet" href="../css/custom.css"/>
    <link rel="stylesheet" href="../css/rating.css"/>
    <style>
        .maintxt {
            background: linear-gradient(
                    rgba(0, 0, 0, 0.45),
                    rgba(0, 0, 0, 0.45)
            ), /* bottom, image */ url(../assets/merchants/meal-5590186.jpg);
            background-size: cover;
            background-position: center !important;
            border-radius: 10px;

        }

    </style>

</head>
<body>
<div data-role="page">
    <div class="top pl-3 pr-3 pb-2 fixed-top">
        <div data-role="header" class="mb-1 header">
            <button data-rel="back" class="ui-btn ui-btn-icon-left ui-icon-back custom-back">Back</button>
            <h1>
                <img src="../assets/logos/MainLight.png" class="img-fluid" alt="Logo.png">
            </h1>
            <button class="ui-btn-right ui-btn ui-btn-icon-notext ui-icon-notification">Notification</button>
        </div>
        <div class="row justify-content-center">
            <div class="col-sm-10">
                <a href="#popupBasicLocation" data-rel="popup" data-transition="pop"
                   class="ui-btn ui-shadow ui-corner-all ui-btn-icon-left ui-icon-location custom-search-bar">Select
                    Your
                    Location</a>
            </div>
        </div>
        <div class="row mt-n2"> <!--first hr line-->
            <div class="col">
                <hr>
            </div>
        </div>
        <div class="row mt-n3"> <!--search by name and filtering row-->
            <div class="col-10 mr-auto pt-2">
                <input data-type="search" id="searchForCollapsibleSet" name="search" value=""
                       placeholder="Search Restaurant by Name"/>
            </div>
            <div class="col-auto">
                <a href="#popupBasic" data-rel="popup" data-transition="pop"
                   class="ui-btn ui-corner-all ui-icon-filter ui-btn-icon-notext custom-filter-button">Filter</a>
            </div>
        </div>
        <div class="row mt-n3">  <!--second hr line-->
            <div class="col">
                <hr>
            </div>
        </div>
        <div class="row mt-n3">
            <div class="col">Home/Search</div>
        </div>

        <!--Location Modal-->
        <div data-role="popup" id="popupBasicLocation" class="custom-location" data-position-to="window"
             data-overlay-theme="a" data-transition="pop">
            <div class="row mb-2">
                <div class="col-8">
                </div>
                <div class="col-4 custom-close-button">
                    <a href="#" data-rel="back" data-role="button" data-transition="pop"
                       class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all m-0">No text</a>
                </div>
            </div>
            <form>
                <div class="ui-input-search ui-body-inherit ui-corner-all ui-shadow-inset ui-input-has-clear">
                    <input data-type="search" data-enhanced="true" data-inset="false" id="pre-rendered-example-input"
                           placeholder="Search by locations..." value="">
                </div>
                <div data-role="controlgroup" data-enhanced="true" data-filter="true" data-filter-reveal="true"
                     data-input="#pre-rendered-example-input"
                     class="ui-controlgroup ui-controlgroup-vertical ui-corner-all">
                    <div class="ui-controlgroup-controls">
                        <a href="#"
                           class="ui-btn ui-corner-all ui-shadow ui-shadow ui-screen-hidden ui-btn-icon-left ui-icon-location">Colombo
                            10</a>
                        <a href="#"
                           class="ui-btn ui-corner-all ui-shadow ui-first-child ui-shadow ui-last-child ui-btn-icon-left ui-icon-location">Colombo
                            11</a>
                        <a href="#"
                           class="ui-btn ui-corner-all ui-shadow ui-shadow ui-screen-hidden ui-btn-icon-left ui-icon-location">Maradana</a>
                    </div>
                </div>
            </form>
        </div>
        <!--Filters Modal-->
        <div data-role="popup" id="popupBasic" class="custom-filter" data-position-to="window" data-overlay-theme="a"
             data-transition="pop">
            <div class="row mb-2">
                <div class="col-8">
                    <label><strong>Categories </strong> </label>
                </div>
                <div class="col-4 custom-close-button">
                    <a href="#" data-rel="back" data-role="button" data-transition="pop"
                       class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all m-0">No text</a>
                </div>
            </div>

            <form>
                <div class="row mb-3">
                    <div class="col-6">
                        <div class="row">
                            <div class="col-4">
                                <label for="flip-1">Pizza</label>
                            </div>
                            <div class="col-8 custom-switch">
                                <select name="flip-1" id="flip-1" data-role="slider" style="width: 4.0em;">
                                    <option value="off"></option>
                                    <option value="on"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="row">
                            <div class="col-4">
                                <label for="flip-2">Noodles</label>
                            </div>
                            <div class="col-8 custom-switch">
                                <select name="flip-2" id="flip-2" data-role="slider" style="width: 4.0em;">
                                    <option value="off"></option>
                                    <option value="on"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="row mb-3">
                    <div class="col-6">
                        <div class="row">
                            <div class="col-4">
                                <label for="flip-3">Bakery</label>
                            </div>
                            <div class="col-8 custom-switch">
                                <select name="flip-3" id="flip-3" data-role="slider" style="width: 4.0em;">
                                    <option value="off"></option>
                                    <option value="on"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                    <div class="col-6">
                        <div class="row">
                            <div class="col-4">
                                <label for="flip-4">Chinese</label>
                            </div>
                            <div class="col-8 custom-switch">
                                <select name="flip-4" id="flip-4" data-role="slider" style="width: 4.0em;">
                                    <option value="off"></option>
                                    <option value="on"></option>
                                </select>
                            </div>
                        </div>
                    </div>
                </div>
            </form>
            <form>
                <div data-role="rangeslider">
                    <label for="range-1a" class="mb-3"><strong>Price Range (LKR)</strong></label>
                    <input type="range" name="range-1a" id="range-1a" min="0" max="100" value="40">
                    <label for="range-1b">Rangeslider:</label>
                    <input type="range" name="range-1b" id="range-1b" min="0" max="100" value="80">
                </div>
            </form>

            <div class="row mb-3 mt-3">
                <div class="col-6">
                    <a href="#" data-rel="back" data-role="button" class="ui-btn">Cancel</a>
                </div>
                <div class="col-6">
                    <button class="ui-btn">Apply</button>
                </div>
            </div>
        </div>

    </div>

    <div class="main"> <!--content area starts from here-->
        <div class="mr-2 ml-2 mt-n4">
            <div class="row m-0 pl-3 pr-3 mb-4">
                <div class="col-12 m-0 p-0">
                    <span class="pb-2 text-black order-type-tab-bar" id="ongoingOrdersTab"
                          style="border-bottom: 3px solid #ec7a23;">Ongoing Orders (3)</span>
                    <span class="ml-3 pb-2 text-black order-type-tab-bar" id="pastOrdersTab"
                          style="border-bottom: 3px solid #bebbb7;">Past Orders (2)</span>
                </div>
            </div>
        </div>
        <!--Ongoing Orders-->
        <div class="container row m-0" id="onGoingOrders" style="max-width:100%">

            <!--<div class="col-sm-12 col-md-6 p-1">
                <div class="maintxt prd-1-normal">
                    <div class="container overlay-text mt-2 pt-2 pb-2">
                        <div class="row col-12 m-0  p-0">
                            <div class="col-12 m-0 p-0">
                                <h5 class="text-white">Order #2121</h5>
                            </div>
                        </div>
                        <div class="row m-0">
                            <div class="col-6 m-0 p-0">
                                <span class="pb-3 text-white" style="font-size: 14px">Total LKR1050.00</span>
                            </div>
                            <div class="col-6 m-0 p-0" style="text-align: end !important ">
                                <span class="pb-3 text-white prd-1-normal-down">^</span>
                            </div>
                        </div>
                        <div class="row col-12 m-0 p-0 pb-1">
                            <div class="col-12 m-0 p-0">
                                <span class="text-white pl-1 pr-2 order-status-container">COMPLETED</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>-->
        </div>

        <!--Past orders-->
        <div class="container row m-0" id="pastOrders" style="max-width:100%">

        </div>


        <!--*******************food preparing modal****************************-->
        <div data-role="popup" id="popupTrack" style=" width: 300px !important;
        height: 350px!important;" data-position-to="window" data-overlay-theme="a"
             data-history="false" data-transition="pop">
            <div class="row mt-3">
                <div class="col-8">
                </div>
                <div class="col-4 custom-close-button" style="padding-right: 25px;">
                    <a href="#" data-rel="back" data-role="button" data-transition="pop"
                       class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all m-0">No text</a>
                </div>
            </div>
            <div style="text-align: -webkit-center;">
                <img alt="this slowpoke moves" id="popupTrackImg" src="./../assets/gifs/31454-food-prepared-food-app.gif"
                     width=200/>
            </div>
            <div class="row mb-2" style="text-align: -webkit-center;">
                <div class="col-12 text-black" id="popupTrackText" style="font-size: 18px; font-weight: bold;">
                    Food is Preparing
                </div>
            </div>
        </div>


        <!-- *******************Driver Rating modal******************************-->
        <div data-role="popup" id="driver-rating-modal" style=" width: 300px !important;
        height: 350px!important;" data-position-to="window" data-overlay-theme="a"
             data-history="false" data-transition="pop">
            <div class="row mt-3">
                <div class="col-8">
                </div>
                <div class="col-4 custom-close-button" style="padding-right: 25px;">
                    <a href="#" data-rel="back" data-role="button" data-transition="pop"
                       class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all m-0">No text</a>
                </div>
            </div>
            <div style="text-align: -webkit-center;">
                <img src="./../assets/gifs/21653-delivery-guy-out-for-delivery.gif"
                     alt="this slowpoke moves"
                     width=170px style="border-radius: 50%;box-shadow: 2px 2px 5px 1px rgb(0 0 0 / 14%);"/>
            </div>
            <div class="row mb-2 mt-3" style="text-align: -webkit-center;">
                <div class="col-12 text-black" style="font-size: 18px; font-weight: bold;">
                    Driver
                </div>
                <div class="stars" data-role="none"
                     style="margin-right: auto;margin-left: auto;display: block">
                    <input class="star star-5" data-role="none" id="driver-rating-star-5" name="star1" type="radio"/>
                    <label data-role="none" class="star star-5" for="driver-rating-star-5" onClick=""></label>
                    <input class="star star-4" data-role="none" id="driver-rating-star-4" name="star1" type="radio"/>
                    <label data-role="none" class="star star-4" for="driver-rating-star-4"></label>
                    <input class="star star-3" data-role="none" id="driver-rating-star-3" name="star1" type="radio"/>
                    <label data-role="none" class="star star-3" for="driver-rating-star-3"></label>
                    <input class="star star-2" data-role="none" id="driver-rating-star-2" name="star1" type="radio"/>
                    <label data-role="none" class="star star-2" for="driver-rating-star-2"></label>
                    <input checked class="star star-1" data-role="none" id="driver-rating-star-1" name="star1" type="radio"/>
                    <label data-role="none" class="star star-1" for="driver-rating-star-1"></label>
                </div>
            </div>
            <div>
                <button class="ui-btn" id="btnDriverRatingNext" style="background-color: #EC7A23 !important;
                             color: white !important;
                             border-radius: 25px !important;
                             margin: auto !important;
                             text-shadow: none !important;">Next
                </button>
            </div>
        </div>
        <!--*********************************END**********************************-->

        <!-- *******************Merchant Rating modal******************************-->
        <div data-history="false" data-overlay-theme="a" data-position-to="window" data-role="popup" data-transition="pop"
             id="merchant-rating-modal" style=" width: 300px !important;
        height: 350px!important;">
            <div class="row mt-3">
                <div class="col-8">
                </div>
                <div class="col-4 custom-close-button" style="padding-right: 25px;">
                    <a class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all m-0" data-rel="back" data-role="button" data-transition="pop"
                       href="#">No text</a>
                </div>
            </div>
            <div style="text-align: -webkit-center;">
                <img alt="this slowpoke moves" id="merchantRatingImg"
                     src="./../assets/gifs/21652-delivery-guy-waiting.gif"
                     style="border-radius: 50%;box-shadow: 2px 2px 5px 1px rgb(0 0 0 / 14%);" width=170px/>
            </div>
            <div class="row mb-2 mt-3" style="text-align: -webkit-center;">
                <div class="col-12 text-black" style="font-size: 18px; font-weight: bold;">
                    Merchant
                </div>
                <div class="stars" data-role="none"
                     style="margin-right: auto;margin-left: auto;display: block">
                    <input class="star star-5" data-role="none" id="merchant-rating-star-5" name="star" type="radio"/>
                    <label class="star star-5" data-role="none" for="merchant-rating-star-5" onClick=""></label>
                    <input class="star star-4" data-role="none" id="merchant-rating-star-4" name="star" type="radio"/>
                    <label class="star star-4" data-role="none" for="merchant-rating-star-4"></label>
                    <input class="star star-3" data-role="none" id="merchant-rating-star-3" name="star" type="radio"/>
                    <label class="star star-3" data-role="none" for="merchant-rating-star-3"></label>
                    <input class="star star-2" data-role="none" id="merchant-rating-star-2" name="star" type="radio"/>
                    <label class="star star-2" data-role="none" for="merchant-rating-star-2"></label>
                    <input checked class="star star-1" data-role="none" id="merchant-rating-star-1" name="star" type="radio"/>
                    <label class="star star-1" data-role="none" for="merchant-rating-star-1"></label>
                </div>
            </div>
            <div>
                <button class="ui-btn" id="btnMerchantRatingNext" style="background-color: #EC7A23 !important;
                             color: white !important;
                             border-radius: 25px !important;
                             margin: auto !important;
                             text-shadow: none !important;">Next
                </button>
            </div>
        </div>
        <!--*********************************END**********************************-->


        <!--**********************************************************shop rating modal***************************************************-->
        <div data-history="false" data-position-to="window" data-role="popup" id="product-rating-modal" style=" width: 300px !important;"
             data-overlay-theme="a"
             data-transition="pop">
            <div class="row mt-3">
                <div class="col-8">
                </div>
                <div class="col-4 custom-close-button" style="padding-right: 25px;">
                    <a href="#" data-rel="back" data-role="button" data-transition="pop"
                       class="ui-btn ui-icon-delete ui-btn-icon-notext ui-corner-all m-0">No text</a>
                </div>
            </div>
            <div style="text-align: -webkit-center;">
                <img id="productModalRatingImg" src=""
                     alt="this slowpoke moves"
                     width=170px style="border-radius: 50%;box-shadow: 2px 2px 5px 1px rgb(0 0 0 / 14%);"/>
            </div>
            <div class="row mt-3" style="text-align: -webkit-center;">
                <div class="col-12 text-black" style="font-size: 18px; font-weight: bold;">
                    Driver
                </div>
                <div class="stars" data-role="none"
                     style="margin-right: auto;margin-left: auto;display: block">
                    <input class="star star-5" data-role="none" id="shop-rating-modal-star-5" name="productStar" type="radio"/>
                    <label data-role="none" class="star star-5" for="shop-rating-modal-star-5"
                           onClick=""></label>
                    <input class="star star-4" data-role="none" id="shop-rating-modal-star-4" name="productStar" type="radio"/>
                    <label data-role="none" class="star star-4" for="shop-rating-modal-star-4"></label>
                    <input class="star star-3" data-role="none" id="shop-rating-modal-star-3" name="productStar" type="radio"/>
                    <label data-role="none" class="star star-3" for="shop-rating-modal-star-3"></label>
                    <input class="star star-2" data-role="none" id="shop-rating-modal-star-2" name="productStar" type="radio"/>
                    <label data-role="none" class="star star-2" for="shop-rating-modal-star-2"></label>
                    <input checked class="star star-1" data-role="none" id="shop-rating-modal-star-1" name="productStar" type="radio"/>
                    <label data-role="none" class="star star-1" for="shop-rating-modal-star-1"></label>
                </div>
            </div>
            <div class="container">
                <div class="row mb-2" style="">
                    <div class="col-12 text-black" style="font-size: 18px; font-weight: bold;">
                        Comments
                    </div>
                    <div class="col-12 mb-3">

                            <textarea class="mb-3" cols="40" id="commentTextarea" name="textarea-1" rows="8"
                                      placeholder="Some text"></textarea>
                            <button class="ui-btn" id="productRatingSubmit" style="background-color: #EC7A23 !important;
                             color: white !important;
                             border-radius: 25px !important;
                             margin: auto !important;
                             text-shadow: none !important;">Submit
                            </button>

                    </div>
                </div>
            </div>
        </div>
        <!--*********************************END**********************************-->

    </div>


    <!--Footer-->
    <div class="footer">
        <div class="row justify-content-between">
            <div class="col d-flex justify-content-left ml-3 p-3">
                <img src="../assets/logos/AltDark.png" class="img-fluid" alt="logo">
            </div>
            <div class="col mr-3 p-3">
                <div class="row">
                    <div class="col font1">Privacy Policy Terms of Use</div>
                    <div class="w-100"></div>
                    <div class="col font2">Â© 2020 HOMEAL. All rights reserved</div>
                </div>
            </div>
        </div>
    </div>

    <div data-role="footer" class="fixed-bottom">
        <nav data-role="navbar">
            <ul>
                <li><a href="#" class="ui-btn ui-icon-home ui-btn-icon-top ui-btn-active ui-state-persist">Home</a></li>
                <li><a href="#" class="ui-btn ui-icon-orders ui-btn-icon-top">Orders</a></li>
                <li><a href="#" class="ui-btn ui-icon-cart ui-btn-icon-top">Cart</a></li>
                <li><a href="#" class="ui-btn ui-icon-profile ui-btn-icon-top">Profile</a></li>
            </ul>
        </nav>
    </div>
</div>
</body>
<script>
    let pastOrdersJsonArr, onGoingOrdersJsonArr;
    let setTimeOut1, setTimeOut2, setTimeOut3;
    $(document).ready(function () {
        $('.star').removeClass('ui-radio');
        let pastOrders = sessionStorage.getItem('pastOrders');
        if (!pastOrders) {
            pastOrdersJsonArr = "[]";
        } else {
            pastOrdersJsonArr = pastOrders;
        }
        pastOrdersJsonArr = JSON.parse(pastOrdersJsonArr);
        onGoingOrdersJsonArr = sessionStorage.getItem('onGoingOrders');
        if (onGoingOrdersJsonArr) {
            onGoingOrdersJsonArr = JSON.parse(onGoingOrdersJsonArr);
        } else {
            onGoingOrdersJsonArr = JSON.parse("[]");
        }
        loadOnGoingOrders();
        loadPasOrders();
    });

    function loadOnGoingOrders() {
        let ongoingOrdersTab = $('#onGoingOrders');
        ongoingOrdersTab.empty();
        let onGoingOrdersCards = '';
        $.each(onGoingOrdersJsonArr, function (i, order) {
            let card = `
               <div id="${order['order_id']}" class="col-sm-12 col-md-6 p-1">
                <div id="${order['order_id']}-extend">
                    <div style="padding-bottom:1em;background: linear-gradient(
                    rgba(0, 0, 0, 0.45),
                    rgba(0, 0, 0, 0.45)
                    ),  url(${order['bg_img']});
                    background-size: cover;
                    background-position: center !important;
                    border-radius: 10px;">

                        <div class="container overlay-text mt-2 pt-2">
                            <div class="row col-12 m-0  p-0">
                                <div class="col-8 m-0 p-0">
                                    <h5 class="pb-3 text-white">Order #${order['order_id']}</h5>
                                </div>
                                <div class="col-4 m-0 p-0 cardSwitch" style="text-align: end !important"
                                data-order-id="${order['order_id']}">
                                    <span class="pb-3 text-white">^</span>
                                </div>
                            </div>`;
            $.each(order['items'], function (i, item) {
                card += `<div class="row m-0">
                                <div class="col-6 m-0 p-0">
                                    <h5 class="text-white" style="font-size: 16px">${item['name']}(${item['qty']})</h5>
                                </div>
                                <div class="col-6 m-0 p-0" style="text-align: end !important ">
                                    <span class="text-white" style="font-size: 14px">${item['variant']} LKR ${item['price']}</span>
                                </div>
                            </div>
                            `;
            });
            card += `<div class="row m-0 pt-3">
                    <div class="col-12 m-0 p-0" style="text-align: end !important ">
                        <span class="pb-3 text-white" style="font-size: 14px">Tax LKR ${order['tax']}</span>
                    </div>
                </div>
                <div class="row m-0">
                    <div class="col-12 m-0 p-0" style="text-align: end !important ">
                        <span class="pb-3 text-white" style="font-size: 14px">Delivery LKR ${order['delivery']}</span>
                    </div>
                </div>
                <div class="row m-0">
                    <div class="col-6 m-0 p-0">
                        <span class="text-white pl-1 pr-2 order-status-container">PENDING</span>
                    </div>
                    <div class="col-6 m-0 p-0" style="text-align: end !important ">
                        <span class="pb-3 text-white" style="font-size: 14px">Total LKR ${order['total']}</span>
                    </div>
                </div>

                <div class="row col-12 m-0 p-0 mt-3">
                    <div class="col-6 m-0 p-0">
                    </div>
                    <div class="col-6 m-0 p-0 btnTrack" data-order-id="${order['order_id']}">
                        <div class="text-center border rounded-pill ml-2 mr-2 text-white"
                             style="border: 2px solid #ff8600 !important; ">
                            <a  href="#" style="color: white; text-decoration: none; font-weight: normal"
                               data-rel="popup"
                               data-transition="pop">Track</a>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            </div>
                <div id="${order['order_id']}-shrink">
                    <div style="background: linear-gradient(
                    rgba(0, 0, 0, 0.45),
                    rgba(0, 0, 0, 0.45)
                    ), url(${order['bg_img']});
                    background-size: cover;
                    background-position: center !important;
                    border-radius: 10px;">
                        <div class="container overlay-text mt-2 pt-2 pb-2">
                            <div class="row col-12 m-0  p-0">
                                <div class="col-12 m-0 p-0">
                                    <h5 class="text-white">Order #${order['order_id']}</h5>
                                </div>
                            </div>
                            <div class="row m-0">
                                <div class="col-6 m-0 p-0">
                                    <span class="pb-3 text-white" style="font-size: 14px">Total LKR ${order['total']}</span>
                                </div>
                                <div class="col-6 m-0 p-0 cardSwitch2" style="text-align: end !important"
                                    data-order-id="${order['order_id']}">
                                    <span class="pb-3 text-white prd-1-normal-down">&#8964;</span>
                                </div>
                            </div>
                            <div class="row col-12 m-0 p-0 pb-1">
                                <div class="col-12 m-0 p-0">
                                    <span class="text-white pl-1 pr-2 order-status-container">PENDING</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                `;
            onGoingOrdersCards += card;
        });
        ongoingOrdersTab.append(onGoingOrdersCards);
        $.each(onGoingOrdersJsonArr, function (i, order) {
            let orderId = order['order_id'];
            $('#' + orderId +'-shrink').show();
            $('#' + orderId +'-extend').hide();
        });
        showOngoingOrders();
    }

    $(document).on('click', '.btnTrack', function () {
        let orderId = $(this).data('order-id');
        let popupTrack = $('#popupTrack');
        popupTrack.popup('open');
        setTimeOut1 = setTimeout(function() {
            $('#popupTrackImg').attr("src","./../assets/gifs/21652-delivery-guy-waiting.gif");
            $('#popupTrackText').text('Driver is Picking up');
        }, 5000);
        setTimeOut2 = setTimeout(function() {
            $('#popupTrackImg').attr("src","./../assets/gifs/21653-delivery-guy-out-for-delivery.gif");
            $('#popupTrackText').text('Food is on the way');
        }, 10000);
        setTimeOut3 = setTimeout(function() {
            popupTrack.popup('close');
            orderId = orderId.toString();
            onGoingOrdersJsonArr = $.grep(onGoingOrdersJsonArr, function(item) { //remove item from the list
                let id = item['order_id'];
                if (id === orderId) {
                    pastOrdersJsonArr.push(item);
                }
                return id !== orderId;
            });
            sessionStorage.setItem('pastOrders', JSON.stringify(pastOrdersJsonArr));
            sessionStorage.setItem('onGoingOrders', JSON.stringify(onGoingOrdersJsonArr));
            loadOnGoingOrders();
            loadPasOrders();
        }, 15000);
    });

    $('#popupTrack').on("popupafterclose", function () {
        //any action you want like opening another popup
        clearTimeout(setTimeOut1);
        clearTimeout(setTimeOut2);
        clearTimeout(setTimeOut3);
        $('#popupTrackImg').attr("src","./../assets/gifs/31454-food-prepared-food-app.gif");
        $('#popupTrackText').text('Food is preparing');
    });

    $(document).on('click', '.cardSwitch', function () {
        let orderId = $(this).data('order-id').toString();
        $('#' + orderId +'-extend').hide();
        $('#' + orderId +'-shrink').show();
    });

    $(document).on('click', '.cardSwitch2', function () {
        let orderId = $(this).data('order-id').toString();
        $('#' + orderId +'-shrink').hide();
        $('#' + orderId +'-extend').show();
    });

    $('#ongoingOrdersTab').click(function () {
        showOngoingOrders();
    });
    $('#pastOrdersTab').click(function () {
        showPastOrders();
    });

    function showOngoingOrders() {
        let onGoingOrdersTab = $('#ongoingOrdersTab');
        let pastOrdersTab = $('#pastOrdersTab');
        onGoingOrdersTab.text('Ongoing Orders (' + onGoingOrdersJsonArr.length + ')');
        onGoingOrdersTab.css("border-bottom", "3px solid #ec7a23");
        pastOrdersTab.text('Past Orders (' + pastOrdersJsonArr.length + ')')
        pastOrdersTab.css("border-bottom", "3px solid #bebbb7");
        $('#onGoingOrders').show();
        $('#pastOrders').hide();
    }

    function showPastOrders() {
        let onGoingOrdersTab = $('#ongoingOrdersTab');
        let pastOrdersTab = $('#pastOrdersTab');
        onGoingOrdersTab.text('Ongoing Orders (' + onGoingOrdersJsonArr.length + ')');
        onGoingOrdersTab.css("border-bottom", "3px solid #bebbb7");
        pastOrdersTab.text('Past Orders (' + pastOrdersJsonArr.length + ')')
        pastOrdersTab.css("border-bottom", "3px solid #ec7a23");
        $('#onGoingOrders').hide();
        $('#pastOrders').show();
    }

    // Past orders starts from here
    function loadPasOrders() { // cannot call showPastOrders() inside the method since on document ready we have to
        // show ongoing orders
        let pastOrdersTab = $('#pastOrders');
        pastOrdersTab.empty();
        let pastOrdersCards = '';
        $.each(pastOrdersJsonArr, function (i, order) {
            let card = `
               <div id="${order['order_id']}" class="col-sm-12 col-md-6 p-1">
                <div id="${order['order_id']}-extend-past">
                    <div style="padding-bottom:1em;background: linear-gradient(
                    rgba(0, 0, 0, 0.45),
                    rgba(0, 0, 0, 0.45)
                    ),  url(${order['bg_img']});
                    background-size: cover;
                    background-position: center !important;
                    border-radius: 10px;">

                        <div class="container overlay-text mt-2 pt-2">
                            <div class="row col-12 m-0  p-0">
                                <div class="col-8 m-0 p-0">
                                    <h5 class="pb-3 text-white">Order #${order['order_id']}</h5>
                                </div>
                                <div class="col-4 m-0 p-0 pastOrdersCardSwitch" style="text-align: end !important"
                                data-order-id="${order['order_id']}">
                                    <span class="pb-3 text-white">^</span>
                                </div>
                            </div>`;
            $.each(order['items'], function (i, item) {
                card += `<div class="row m-0">
                                <div class="col-6 m-0 p-0">
                                    <h5 class=" text-white" style="font-size: 16px">${item['name']}(${item['qty']})</h5>
                                </div>
                                <div class="col-6 m-0 p-0" style="text-align: end !important ">
                                    <span class=" text-white" style="font-size: 14px">${item['variant']} LKR ${item['price']}</span>
                                </div>
                            </div>
                            `;
            });
            card += `<div class="row m-0 pt-3">
                    <div class="col-12 m-0 p-0" style="text-align: end !important ">
                        <span class="pb-3 text-white" style="font-size: 14px">Tax LKR ${order['tax']}</span>
                    </div>
                </div>
                <div class="row m-0">
                    <div class="col-12 m-0 p-0" style="text-align: end !important ">
                        <span class="pb-3 text-white" style="font-size: 14px">Delivery LKR ${order['delivery']}</span>
                    </div>
                </div>
                <div class="row m-0">
                    <div class="col-6 m-0 p-0">
                        <span class="text-white pl-1 pr-2 order-status-container">COMPLETED</span>
                    </div>
                    <div class="col-6 m-0 p-0" style="text-align: end !important ">
                        <span class="pb-3 text-white" style="font-size: 14px">Total LKR ${order['total']}</span>
                    </div>
                </div>

                <div class="row col-12 m-0 p-0 mt-3">
                    <div class="col-6 m-0 p-0">
                        <div class="text-center border rounded-pill ml-2 mr-2 text-white"
                            style="border: 2px solid #ff8600 !important;">Re-order
                        </div>
                    </div>
                    <div class="col-6 m-0 p-0 btnRate" data-order-id="${order['order_id']}" data-rate-status="0">
                        <div class="text-center border rounded-pill ml-2 mr-2 text-white"
                             style="border: 2px solid #ff8600 !important; ">
                            <a  href="#" style="color: white; text-decoration: none; font-weight: normal"
                               data-rel="popup"
                               data-transition="pop">Rate</a>
                        </div>
                    </div>
                </div>
            </div>
            </div>
            </div>
                <div id="${order['order_id']}-shrink-past">
                    <div style="background: linear-gradient(
                    rgba(0, 0, 0, 0.45),
                    rgba(0, 0, 0, 0.45)
                    ), url(${order['bg_img']});
                    background-size: cover;
                    background-position: center !important;
                    border-radius: 10px;">
                        <div class="container overlay-text mt-2 pt-2 pb-2">
                            <div class="row col-12 m-0  p-0">
                                <div class="col-12 m-0 p-0">
                                    <h5 class="text-white">Order #${order['order_id']}</h5>
                                </div>
                            </div>
                            <div class="row m-0">
                                <div class="col-6 m-0 p-0">
                                    <span class="pb-3 text-white" style="font-size: 14px">Total LKR ${order['total']}</span>
                                </div>
                                <div class="col-6 m-0 p-0 pastOrdersCardSwitch2" style="text-align: end !important"
                                    data-order-id="${order['order_id']}">
                                    <span class="pb-3 text-white prd-1-normal-down">&#8964;</span>
                                </div>
                            </div>
                            <div class="row col-12 m-0 p-0 pb-1">
                                <div class="col-12 m-0 p-0">
                                    <span class="text-white pl-1 pr-2 order-status-container">COMPLETED</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
                `;
            pastOrdersCards += card;
        });
        pastOrdersTab.append(pastOrdersCards);
        $.each(pastOrdersJsonArr, function (i, order) {
            let orderId = order['order_id'];
            $('#' + orderId +'-shrink-past').show();
            $('#' + orderId +'-extend-past').hide();
        });
    }

    $(document).on('click', '.pastOrdersCardSwitch', function () {
        let orderId = $(this).data('order-id').toString();
        $('#' + orderId +'-extend-past').hide();
        $('#' + orderId +'-shrink-past').show();
    });

    $(document).on('click', '.pastOrdersCardSwitch2', function () {
        let orderId = $(this).data('order-id').toString();
        $('#' + orderId +'-shrink-past').hide();
        $('#' + orderId +'-extend-past').show();
    });

    let selectedPastOrderCard;
    let btnDriverRatingNextClicked = false; //to check whether user has clicked the next button so that next modal will open
    let btnMerchantRatingNextClicked = false;

    $(document).on('click', '.btnRate', function () {
        // rateStatus: 0 (driver modal), rateStatus: 1 (merchant modal), anyOther(product modal
        selectedPastOrderCard = $(this);
        let rateStatus = parseInt(selectedPastOrderCard.data('rate-status'));
        let orderId= selectedPastOrderCard.data('order-id').toString();
        console.log(typeof(rateStatus), rateStatus);
        if (rateStatus === 0) {
            $("#driver-rating-star-1").prop("checked", true);
            $('#driver-rating-modal').popup('open');
        } else if (rateStatus === 1) {
            openMerchantRatingModal();
        } else {
            openProductRatingModal(orderId);
        }
    });

    $('#btnDriverRatingNext').click(function () {
        btnDriverRatingNextClicked = true;
       selectedPastOrderCard.data('rate-status', 1);
       $('#driver-rating-modal').popup('close');
    });

    $('#btnMerchantRatingNext').click(function () {
        btnMerchantRatingNextClicked = true;
        selectedPastOrderCard.data('rate-status', 2);
        $('#merchant-rating-modal').popup('close');
    });

    $('#productRatingSubmit').click(function () {
        $('#product-rating-modal').popup('close');
    })

    $('#driver-rating-modal').on("popupafterclose", function () {
        if (btnDriverRatingNextClicked) {
            openMerchantRatingModal();
            btnDriverRatingNextClicked = false;
        }
    });
    $('#merchant-rating-modal').on("popupafterclose", function () {
        if (btnMerchantRatingNextClicked) {
            let orderId= selectedPastOrderCard.data('order-id').toString();
            openProductRatingModal(orderId);
            btnMerchantRatingNextClicked = false;
        }
    });

    function openMerchantRatingModal() {
        let orderId= selectedPastOrderCard.data('order-id').toString();
        let order = pastOrdersJsonArr.find(x => x['order_id'] === orderId);
        $('#merchantRatingImg').attr('src', order['bg_img']);
        $("#merchant-rating-star-1").prop("checked", true);
        $('#merchant-rating-modal').popup('open');
    }

    function openProductRatingModal(orderId) {
        $('#commentTextarea').val('');
        let order = pastOrdersJsonArr.find(x => x['order_id'] === orderId);
        let merchant_id = order['merchant_id'];
        let productId = order['items'][0]['product_id'];
        let merchantJsonArr = JSON.parse(sessionStorage.getItem('products'));
        let merchant = merchantJsonArr.find(x => x['merchant_id'] === merchant_id);
        let productsArr = merchant['products'];
        let product = productsArr.find(x => x['product_id'] === productId);
        $('#productModalRatingImg').attr('src', product['product_img_path']);
        $('#product-rating-modal').popup('open');
        console.log(productId);
        // $('#productModalRatingImg').
    }






</script>
</html>
